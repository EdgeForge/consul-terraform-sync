name: build

#temp on push to test all the changes
on: push

jobs:
  get-product-version:
    runs-on: ubuntu-latest
    outputs:
      product-version: ${{ steps.get-product-version.outputs.product-version }}
    steps:
      - uses: actions/checkout@v2
      - name: get product version
        id: get-product-version
        run: |
#          make version
          MKFILE_PATH := $(lastword $(MAKEFILE_LIST))
          CURRENT_DIR := $(patsubst %/,%,$(dir $(realpath $(MKFILE_PATH))))
          VERSION := $(shell awk -F\" '/Version/ { print $$2; exit }' "${CURRENT_DIR}/version/version.go")
          make dev
#          echo "::set-output name=product-version::$(make version)"